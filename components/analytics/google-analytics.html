<!-- Google Analytics 4 (GA4) -->
<script>
    // Load GA Measurement ID from config or use default
    const GA_MEASUREMENT_ID = window.ANALYTICS_CONFIG?.GA_MEASUREMENT_ID || 'G-5F8EJP5WXD';
    const GA_ENABLED = window.ANALYTICS_CONFIG?.ENABLED !== false;
    
    if (GA_ENABLED && GA_MEASUREMENT_ID) {
        // Dynamically load gtag.js script with the correct ID
        const script = document.createElement('script');
        script.async = true;
        script.src = `https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`;
        document.head.appendChild(script);
        
        // Initialize gtag after script loads
        script.onload = function() {
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', GA_MEASUREMENT_ID, {
                // Privacy-friendly settings
                'anonymize_ip': true,
                'allow_google_signals': false,
                'allow_ad_personalization_signals': false
            });
            
            // Track page views on navigation (for SPA-like behavior)
            if (typeof window !== 'undefined' && window.history) {
                let lastUrl = location.href;
                new MutationObserver(() => {
                    const url = location.href;
                    if (url !== lastUrl) {
                        lastUrl = url;
                        gtag('config', GA_MEASUREMENT_ID, {
                            'page_path': location.pathname + location.search
                        });
                    }
                }).observe(document, { subtree: true, childList: true });
            }
        };
    }
</script>

